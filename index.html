<!Doctype html>
<html>

	

	
<style>
	
	
.product_button {
    background:url(https://res.cloudinary.com/djtjkiytu/image/upload/v1585678931/Web_-_Design_-_Device_128-512.png) no-repeat;
    cursor:pointer;
    width: 20px;
    height: 20px;
    border: none;
    background-size: cover;
    position: absolute;
}
	
	
.product_container_a{
	width:100%;
	height:50px;
	background-color: #AAB5B2;
	display: flex;
	align-items: center

}
.product_container_b{
	width:100%;
	height:50px;
	background-color: #C7D4D1;
	display: flex;
	align-items: center

}
.product_checkbox{
	margin:20px;
}
.product_img{
	height:90%;
}
.product_name{
	position: absolute;
	margin-left:200px;
}
.product_hidden{
	display: none;
}
	
	
div.products {
  height: 300px;
  width: 200px;
  overflow-y: auto;
  position: absolute;
  top: 100px;
}
		
  #alertBind {
	  font-family: "Myriad pro","Trebuchet MS","Lucida Grande","Lucida Sans Unicode","Lucida Sans",sans-serif;
    position: absolute;
    top: 100px;
    left: 20px;
}
	
 #customerData {
	  font-family: "Myriad pro","Trebuchet MS","Lucida Grande","Lucida Sans Unicode","Lucida Sans",sans-serif;
    position: absolute;
    top: 120px;
    left: 20px;
}
	
	
  .sendContent {
    background-color: #4D4F72;
    border: none;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 4px;
    cursor: pointer;
	  border-radius: 4px;
	  -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
	  font-family: "Myriad pro","Trebuchet MS","Lucida Grande","Lucida Sans Unicode","Lucida Sans",sans-serif;

}
.sendContent:hover {
    background-color: #060837;
    color: white;	
}
	
.sendContent:disabled,
.sendContent[disabled]{
  background-color: #AAB5B2;
  opacity: 0.5;
}
  
  .back {
    background-color: #4D4F72;
    border: none;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 4px;
    cursor: pointer;
	  border-radius: 4px;
	  -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
	  font-family: "Myriad pro","Trebuchet MS","Lucida Grande","Lucida Sans Unicode","Lucida Sans",sans-serif;
    position: absolute;
    bottom: 10px;
    right: 10px;
}
.back:hover {
    background-color: #060837;
    color: white;	
}
  
.btn-group button {
  background-color: #4D4F72;
  border: 1px solid #060837;
  color: white; /* White text */
  padding: 10px 24px;
  cursor: pointer;
  width: 100%;
  display: block;
  text-align: left;
  font-size: 16px;
}

.btn-group button:not(:last-child) {
  border-bottom: none; /* Prevent double borders */
}

/* Add a background color on hover */
.btn-group button:hover {
  background-color: #060837;
}
</style>
  
  
  <head>
	  <script src="https://lpcdn.lpsnmedia.net/webagent/client-SDK.min.js"></script>
	  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
	  
    
    
 <script>
	 
	 var convID;
	 var isAuthenticated = false;
	 var refreshIntervalId;
	 
	 var myProducts = {
		 "products":
		 [{"id":"tyiukygoublygi",
		   "vertical":"telco",
		   "name":"iPhone X",
		   "price":"499.99",
		   "tax":"49.99",
		   "currency":"GBP",
		   "image":"https://res.cloudinary.com/djtjkiytu/image/upload/v1584569289/mycar.png"
		 },
		 {"id":"uyfguyfuyfuyf",
		  "vertical":"telco",
		  "name":"iPhone XR",
		  "price":"599.99",
		  "tax":"59.99",
		  "currency":"GBP",
		  "image":"https://res.cloudinary.com/djtjkiytu/image/upload/v1547634069/ytyp59erht00978sqnxu.jpg"
		 }]
	 };
	 
	 function uuidv4() {
		 return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
			 var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
			 return v.toString(16);
		 });
	 }
	 
	 
	 
	 
	 
	 
	 function sendListPicker(){
		 
		 var elementsLength = document.querySelectorAll('input[type="checkbox"]:checked').length;
		 var JSONtoString = "";
		 for (var a = 0; a < elementsLength; a++){
			 var myIdCheckBox = document.querySelectorAll('input[type="checkbox"]:checked')[a].id;
			 var myIdNumber = myIdCheckBox.substring(10, 11);
			 var idToSearch = "#myLabel" + myIdNumber;
			 var myProductName = $(idToSearch)[0].innerHTML;
			 idToSearch = "#myPrice" + myIdNumber;
			 var myProductPrice = $(idToSearch)[0].innerHTML;
			 idToSearch = "#myTax" + myIdNumber;
			 var myProductTax = $(idToSearch)[0].innerHTML;
			 idToSearch = "#myCurrency" + myIdNumber;
			 var myProductCurrency = $(idToSearch)[0].innerHTML;
			 idToSearch = "#myImg" + myIdNumber;
			 var myProductImg = $(idToSearch)[0].src;
			 
			 var myText = myProductName + " - " + myProductCurrency + myProductPrice;
			 
			 
			 var elementToAdd = {"type":"horizontal",
					     "elements":[{"type":"image",
							  "url":myProductImg
							 },{"type":"vertical",
							    "elements":[{"type":"text",
									 "tag":"title",
									 "text":myProductName
									},{"type":"text",
									   "tag":"subtitle",
									   "text":myText}]
							   }]
					    }
			 
			 JSONtoString = JSONtoString + JSON.stringify(elementToAdd) + ",";
			 
			 
		 }
		 
		 
		 JSONtoString = JSONtoString.substring(0, JSONtoString.length - 1);
		 
		 JSONtoString = '{"type":"vertical","tag":"list","elements":[{"type":"vertical","elements":[{"type":"text","text":""},' + JSONtoString + "]}]}";
		 
		 var listPickerSC = JSON.parse(JSONtoString);
		 
		 var metadataSC = [{"type":"BusinessChatMessage",
				    "multipleSelection":true,
				    "receivedMessage":{"style":"icon",
						       "subtitle":"Please select from the below list",
						       "title":"Choose from one of our available products",
						       "imageURL":"https://liveengage-abc.herokuapp.com/img/routing/routing_lstpkr_wdgt.png"}
				   }]
		 
		 var cmdName = lpTag.agentSDK.cmdNames.writeSC;
		 var payload = {
			 json: listPickerSC,
			 metadata: metadataSC
		 };
		 
		 lpTag.agentSDK.command(cmdName, payload, function (err) {
			 if(err){
				 console.log(err);
			 } else{
				 console.log("done");
			 }
		 });
				 

		  
		 
		 
	 }
	 
	 
	 
	 
	 
	 
	 function sendApplePay(){
		 var myIdCheckBox = document.querySelectorAll('input[type="checkbox"]:checked')[0].id;
		 var myIdNumber = myIdCheckBox.substring(10, 11);
		 var idToSearch = "#myLabel" + myIdNumber;
		 var myProductName = $(idToSearch)[0].innerHTML;
		 idToSearch = "#myPrice" + myIdNumber;
		 var myProductPrice = $(idToSearch)[0].innerHTML;
		 idToSearch = "#myTax" + myIdNumber;
		 var myProductTax = $(idToSearch)[0].innerHTML;
		 idToSearch = "#myCurrency" + myIdNumber;
		 var myProductCurrency = $(idToSearch)[0].innerHTML;
		 
		 var myBody = {"convid": convID,"nameitem": myProductName,"price": myProductPrice,"tax": myProductTax,"currency": myProductCurrency}
		 
		 console.log(myBody);
		 
		 var xhr = new XMLHttpRequest();
		 xhr.addEventListener("readystatechange", function () {
			 if (this.readyState === 4) {
				 
				 var total = (parseInt(myProductPrice) + parseInt(myProductTax)).toString();
				 var titleBubble = "Apple Pay Request | $" + total;
				 var applePaySC = {
						"type":"vertical",
						"tag":"payment",
						"elements":[
							{"type":"text","text":titleBubble}
						]}
					 
				 
				 
				 var cmdName = lpTag.agentSDK.cmdNames.writeSC;
				 var payload = {
					 json: applePaySC,
					 metadata: xhr.response
				 };
				 
				 lpTag.agentSDK.command(cmdName, payload, function (err) {
					 if(err){
						 console.log(err);
					 } else{
						 console.log("done");
					 }
				 });
				 

			 }	
		 });
		 var URLforPOST = "https://abc-auth.herokuapp.com/applePayPayload";
		 xhr.open("POST", URLforPOST);
		 xhr.setRequestHeader("Content-Type", "application/json");
		 var myBodyToSend = JSON.stringify(myBody);
		 xhr.send(myBodyToSend);
		  
		 
		 
	 }
	 
	 

	 function sendAuthentication(){
		 // do something
		 
		 var myRandomRequest = uuidv4();
		 
		 var authSC = {"type":"vertical",
			       "tag":"authentication",
			       "elements":[{"type":"text",
					    "text":"Authentication Request"}]
			      };
		 var authSCMetadata = [{"type":"BusinessChatMessage",
					"receivedMessage":{"title":"Tap here to sign in",
							   "subtitle":"Thank you",
							   "imageURL":"https://s3.amazonaws.com/sc-tasks/Assets/misc/lplogo.png",
							   "style":"small"},
					"replyMessage":{"title":"Successfully signed in!",
							"subtitle":"Thank you",
							"imageURL":"https://s3.amazonaws.com/sc-tasks/Assets/misc/lplogo.png",
							"style":"small"}},
				       {"type":"ConnectorAuthenticationRequest",
					"requestIdentifier":myRandomRequest}];
		 
		 var cmdName = lpTag.agentSDK.cmdNames.writeSC;
		 var payload = {
			 json: authSC,
			 metadata: authSCMetadata
		 };

		 
		 lpTag.agentSDK.command(cmdName, payload, function (err) {
			 if(err){
				 console.log(err);
			 } else{
				 console.log("done");
				 
				 var xhr = new XMLHttpRequest();
				 xhr.addEventListener("readystatechange", function () {
					 if ((this.readyState === 4) && (!isAuthenticated)) {
						 if (xhr.response === "ok"){
							 document.getElementById("alertBind").innerHTML = "...waiting for some authenticated data...";
							 document.getElementById("alertBind").style = "color : black";
							 console.log(xhr.response);
							 
							 window.clearInterval(refreshIntervalId);
							 refreshIntervalId = setInterval(()=>{
								 
								 if(isAuthenticated){
									 clearInterval(refreshIntervalId);
								 } else{
									 console.log("***ping***");
									 retrieveData();
								 }
							 
							 }, 10000);

						 } else{
							 document.getElementById("alertBind").innerHTML = "Error retrieving authenticated data!";
							 document.getElementById("alertBind").style = "color : red";
							 console.log(xhr.response);
							 setTimeout(function(){
								 document.getElementById("alertBind").innerHTML = "";
							 }, 3000);
						 }
					 }	
				 });
				 var URLforPOST = "https://abc-auth.herokuapp.com/addmanager";
				 xhr.open("POST", URLforPOST);
				 xhr.setRequestHeader("Content-Type", "application/json");
				 var myBodyToSend = JSON.stringify({"convid": convID});
				 xhr.send(myBodyToSend);
				 

				 
			 }
		 });
		 
		 
 
	 }
	 
	 
	 
	 
	 function showAuthentication(){
		 $("#main").attr("hidden", "true");
		 $('#authenticationWindow').removeAttr('hidden');
	 }
	 
	 function showApplePay(){
		 $("#main").attr("hidden", "true");
		 $('#applePayWindow').removeAttr('hidden');
	 }
	 
	 
	 function back(){
		 $('#main').removeAttr('hidden');
		 $("#authenticationWindow").attr("hidden", "true");
		 $("#applePayWindow").attr("hidden", "true");
		 $("#listpickerWindow").attr("hidden", "true");
	 }
	 
	 
	 
	 function retrieveData(){
		 var xhr = new XMLHttpRequest();
		 xhr.addEventListener("readystatechange", function () {
			 if (this.readyState === 4) {
				 console.log(xhr.response);
				 if((xhr.response === "ko") || (xhr.response === "")){
					 document.getElementById("alertBind").innerHTML = "Customer not authenticated!";
					 document.getElementById("alertBind").style = "color : red";
					 return false;
				 } else{
					 isAuthenticated = true;
					 document.getElementById("alertBind").innerHTML = "Customer authenticated!";
					 document.getElementById("alertBind").style = "color : green";
					 var myResponse = JSON.parse(xhr.response);
					 console.log(myResponse.picture);
					 $('#customerPicture').attr('src', myResponse.picture);
					 console.log(myResponse.email);
					 $('#customerEmail').html(myResponse.email);
					 console.log(myResponse.name);
					 $('#customerName').html(myResponse.name);
					 $('#customerData').removeAttr('hidden');
					 return true;
				 }
			 } else{
				 return false;
			 }
		 
		 });
		 var URLforPOST = "https://abc-auth.herokuapp.com/retrievedata";
		 xhr.open("POST", URLforPOST);
		 xhr.setRequestHeader("Content-Type", "application/json");
		 var myBodyToSend = JSON.stringify({"convid": convID});
		 xhr.send(myBodyToSend);
		 
		 
	 }
	 
	 
	 
	 
	 $(document).ready(function() {
		 
		 var myHeight = window.innerHeight - 200;
		 var myWidth = window.innerWidth -20;
		 var myNewHeight = myHeight.toString() + 'px';
		 var myNewWidth = myWidth.toString() + 'px';
		 $('.products').css('height',myNewHeight);
		 $('.products').css('width',myNewWidth);
		 $('.product_button').css('right','10px');
		 
		 var product_container = true;
		 
		 var productLength = myProducts.products.length;
		 
		 for(var z = 0; z < productLength; z++){
			 //creeating the new product element
			 var node = document.createElement("div");
			 if(product_container){
				 node.className = "product_container_a";
				 product_container = false;
			 } else{
				 node.className = "product_container_b";
				 product_container = true;
			 }
			 node.id = myProducts.products[z].id;
			 //appending the checkbox
			 var newCheckBox = document.createElement('input');
			 newCheckBox.type = 'checkbox';
			 newCheckBox.id = 'myCheckBox' + z;
			 newCheckBox.className = "product_checkbox";
			 node.appendChild(newCheckBox);
			 
			 //appending the img
			 var oImg = document.createElement("img");
			 oImg.className = "product_img";
			 oImg.id = 'myImg' + z;
			 oImg.setAttribute('src', myProducts.products[z].image);
			 node.appendChild(oImg);
			 
			 // appending the label
			 var newLabel = document.createElement("LABEL");
			 newLabel.className = "product_name";
			 newLabel.id = 'myLabel' + z;
			 newLabel.innerHTML = myProducts.products[z].name;
			 node.appendChild(newLabel);
			 
			 var newPrice = document.createElement("LABEL");
			 newPrice.className = "product_hidden";
			 newPrice.id = 'myPrice' + z;
			 newPrice.innerHTML = myProducts.products[z].price;
			 node.appendChild(newPrice);
			 
			 var newTax = document.createElement("LABEL");
			 newTax.className = "product_hidden";
			 newTax.id = 'myTax' + z;
			 newTax.innerHTML = myProducts.products[z].tax;
			 node.appendChild(newTax);
			 
			 var newCurrency = document.createElement("LABEL");
			 newCurrency.className = "product_hidden";
			 newCurrency.id = 'myCurrency' + z;
			 newCurrency.innerHTML = myProducts.products[z].currency;
			 node.appendChild(newCurrency);
			 
			 var newBtn = document.createElement("input");
			 newBtn.type = "button";
			 newBtn.className = "product_button";
			 newBtn.id = 'myButton' + z;
			 newBtn.setAttribute("style", "right:10px");
			 node.appendChild(newBtn);
			 
			 
			 // appending the new product inside the list
			 document.getElementsByClassName("products")[0].appendChild(node);
		 }
		 
		 
		 $(".product_checkbox").click(function () {
			 
			 var myNumber = document.querySelectorAll('input[type="checkbox"]:checked').length;
			 if ($(this).is(":checked")) {
				 console.log("my checkboxes1  --> " + myNumber);
			 } else {
				 console.log("my checkboxes1  --> " + myNumber);
			 }
			 if(myNumber === 0){
				 $("#sendApplePay").prop( "disabled", true );
				 $("#sendListPicker").prop( "disabled", true );
				 
			 } else if (myNumber === 1){
				 $("#sendApplePay").prop( "disabled", false );
				 $("#sendListPicker").prop( "disabled", false );
				 
			 } else{
				 $("#sendApplePay").prop( "disabled", true );
				 $("#sendListPicker").prop( "disabled", false );
			 }
			 
			 
		 });
		 
		 
		 

              
              	var SDK = lpTag.agentSDK;
              	SDK.init();

		
                var onSuccess1 = function(data) {
                // Do something with the returning data
                	convID = data;
			retrieveData();

		};
                
                var onError1 = function(data) {
                // Do something with the returning data
                	convID = null;
                };
		
		
             
                SDK.get('chatInfo.rtSessionId', onSuccess1, onError1);
		
               
              
           });
	 
	 
	 
	 
	 
	 $(window).resize(function() {
		 var myHeight = window.innerHeight - 200;
		 var myWidth = window.innerWidth -20;
		 var myNewHeight = myHeight.toString() + 'px';
		 var myNewWidth = myWidth.toString() + 'px';
		 $('.products').css('height',myNewHeight);
		 $('.products').css('width',myNewWidth);
		 $('.product_button').css('right','10px');
		 
	 });
	 
	 
	 
	 

   
   
    </script>

</head>
  
  
  
<body>

<div id="main">
  
<div class="btn-group">
  <button id="authentication" onclick="showAuthentication()">ABC - Authentication</button>
  <button id="applepay" onclick="showApplePay()">ABC - ApplePay & ListPicker</button>
</div>
  
  
  </div>
  
  
  <div id="authenticationWindow" hidden="true">
	  
	  <button id="sendAuthentication" class="sendContent" onclick="sendAuthentication()">Authenticate</button>
	  </br>
	<div id="alertBind"></div>
	<div id="customerData" hidden="true">
		<img id="customerPicture" src="" width="250" height="200"></br></br>
		<label>Name: </label> <div id="customerName"></div></br></br>
		<label>Email: </label> <div id="customerEmail"></div>
	
	</div>
	  <button id="back" class="back" onclick="back()">Back</button>

  
    
    
</div>



  <div id="applePayWindow" hidden="true">
	  
	  <button id="sendApplePay" class="sendContent" onclick="sendApplePay()" disabled>ApplePay</button>
	  <button id="sendListPicker" class="sendContent" onclick="sendListPicker()" style="float: right;" disabled>ListPicker</button>
	  
	  <div class="products"></div>
	  
	  <button id="back" class="back" onclick="back()">Back</button>
	  
  
    
    
</div>
  


  
  
  
  
  

</body>
</html>
